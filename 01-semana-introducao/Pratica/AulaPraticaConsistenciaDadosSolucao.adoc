== prática: consistência de dados (Solução)



### 1 

- Entrada para Fátima Lopes não tem email definido (o atributo não é opcional como Telefone).
- Valor de Telefone para Roberta Rodrigues não é um número.
- Filipe Lopes e António Silva têm o mesmo número mecanográfico.

### 2

__Departamentos e docentes:__

 - O Dep. de Ciências das Coisas não tem docentes.   
   - NÃO _"e em cada departamento existe um docente que é presidente do departamento" (pelo menos o presidente existe)_
 - O Prof. António das Cenas é docente no Dep. de Ciências das Coisas e também presidente do mesmo departamento.
   - SIM. 
 - O Prof. Eduardo Marques é docente do Dep. de Ciência de Computadores.
   - SIM.
 - O Prof. António das Cenas é docente do Dep. de Ciências das Coisas e do Dep. de Física.
   - NÂO _"Cada docente faz parte de um só departamento [...]"_
 - O Dep. de Ciência de Computadores tem como presidentes o Prof. Alípio Jorge e  o Prof. Eduardo Marques, ambos docentes nesse departamento.
   - NÃO _"em cada departamento existe um docente que é presidente do departamento"_ (apenas um)
 - O Dep. Física não tem um presidente.
   - NÃO _"em cada departamento existe um docente que é presidente do departamento"_ (um)
 - O Dep. Ciência de computadores tem como presidente o Prof. António das Cenas que é docente no Dep. Ciências das Coisas.
   - NÃO _"em cada departamento existe um docente que é presidente do departamento"_ (tem de fazer parte do mesmo departamento)


__Departamentos e cursos:__

 - O Dep. de Ciência das Coisas não é responsável por qualquer curso.
   - NÃO _"Cada departamento está associado a pelo menos um curso."_
 - Os cursos de Licenciatura em Ciência de Computadores e Mestrado em Segurança Informática são da responsabilidade do Dep. Ciências dos Computadores.
  - SIM.
 - O curso de Licenciatura em Coisas é da responsabilidade conjunta do Dep. Física e do Dep. Ciência das Coisas.
  - SIM, notar que _"Cada curso tem associado um ou mais departamento responsáveis"_

__Cadeiras:__

 - A cadeira Coisa Nenhuma não tem docentes.
   - NÃO _"um ou mais docentes desse departamento que dão aulas"_
 - A cadeira Coisa Nenhuma não é dada em nenhum curso.
   - NÃO _"e está associada a um ou mais cursos"_
 - A cadeira de Arquitectura de Computadores, responsabilidade do Dep. Ciência Computadores,  é dada a vários cursos da responsabilidade do Dep. Ciência de Computadores.
   - SIM.
 - A cadeira de Probabilidades e Estatística, responsabilidade do Dep. Matemática Aplicada,  é dada a vários cursos incluindo a Lic. em Ciência de Computadores de que é responsável o Dep. Ciência de Computadores.
    - SIM.
 - Eduardo Marques, do Dep. Ciência de Computadores, dá aulas à cadeira Cálculo I do Dep. de Matemática.
    - NÃO _"um ou mais docentes desse departamento"_
 - A cadeira de Bases de Dados é da responsabilidade do Dep. Ciência de Computadores, e tem como docentes Eduardo Marques, Pedro Brandão e Joaquim Silva que são docentes no mesmo departamento.
  - SIM



### 3

### 3.1

- CO: António das Cenas (presidente).
- CC: Alípio Jorge (presidente), Eduardo Marques
- F: Eduardo Marques (presidente), Fátima Lopes

#### 3.2

1. Nº mecanográfico 87654321 não corresponde a nenhum docente.
2. Nº mecanográfico 12345678 diz respeito a um docente do Dep. Ciência de Computadores e não do Dep. Física.
3. Valor de __Presidente__ torna-se inválido para o Dep. Ciência de Computadores.
4. Valor de __Departamento__ torna-se inválido para os docentes associados ao Dep. Ciência Computadores.
5. Departamento com código __Q__ não existe.
6. O número mecanográfico __28373733__ é de um docente já existente (Fátima Lopes).

### 4

#### 4.1

1. Departamentos e cursos:
 - Ciência de Computadores (CC):  LCC e MIERSI
 - Física (F):  LF e LC.
 - Ciência das Coisas (CO): LC. 
 - CC e F são responsáveis por mais de um curso, LC tem dois departamentos responsáveis.
2. Cadeiras e docentes:
 - Bases de Dados (BD): Alípio Jorge e Eduardo Marques.
 - Física I (F1): Fátima Lopes.
 - Sociologia das Coisas (SC): António das Cenas.
3. Cadeiras de Lic. em Coisas: Física I e Sociologia das Coisas.

#### 4.2

1. Não: uma cadeira pode ter vários docentes mas o docente não é do Dep. Física.
2. Sim: uma cadeira pode ter vários docentes e o docente é do Dep. Física.
3. Sim: essa cadeira pode ser associada ao curso de Física.
4. Não: os docentes de BD não são do Dep. Física.
5. Sim: curso de LC perde uma cadeira, LF ganha outra.
6. Sim: BD ainda fica com um docente.
7. Não: F1 fica sem docentes.
8. Não: uma cadeira tem de estar associada a pelo menos um curso.



### 5


[cols="2,1,2", options="header"]
|===
|Operação                                       |Resultado    |Explicação
|Adicione uma venda com o `ClienteID = 3`.      |Inválido     |O `ClienteID = 3` não existe na tabela `Clientes`. Violação de integridade referencial.
|Atualize o stock do produto com `ProdutoID = 1` para `-5`. |Inválido |O stock não pode ser negativo devido à regra de negócio definida.
|Elimine o cliente com `ClienteID = 2`.         |Válido       |O cliente `ClienteID = 2` não possui vendas associadas, então a eliminação é permitida.
|Insira um funcionário com o número de telefone `123456789`. |Inválido |O número de telefone não começa com '9', violando a validação de formato.
|Adicione uma venda com o `ClienteID = 1` e `Valor = 200.00`. |Válido |O cliente `ClienteID = 1` existe, e a venda cumpre todas as regras de integridade.
|Insira um novo produto com o nome “Monitor” e stock inicial de `50`. |Válido |A operação é válida porque o stock é positivo e não viola nenhuma restrição.
|Elimine o cliente com `ClienteID = 1`.         |Inválido     |O cliente possui vendas associadas na tabela `Vendas`, violando a integridade referencial.
|Atualize o telefone do funcionário `FuncionarioID = 1` para `987654321`. |Válido |O novo número é válido, pois começa com '9', atendendo às regras de formato.
|Insira um novo funcionário com o nome “Pedro Almeida” e telefone `934567890`. |Válido |O número de telefone começa com '9', respeitando as validações definidas.
|Tente inserir uma venda sem especificar o `ClienteID`. |Inválido |O `ClienteID` é obrigatório e não pode ser nulo, violando a regra de integridade.
|===


### 6

#### Problemas Identificados

1. **Tabela Hóspedes:**
   - Registos duplicados, onde o mesmo `HospedeID` e informações associadas aparecem mais de uma vez.

2. **Tabela Hotéis:**
   - Registos duplicados com o mesmo `HotelID` e localização.

3. **Tabela Quartos:**
   - Registos duplicados para o mesmo `QuartoID`.
   - Referência inválida, onde um `HotelID` associado a um quarto não existe na tabela de hotéis.

4. **Tabela Reservas:**
   - Referências inválidas, onde:
     - O `HospedeID` associado a uma reserva não existe na tabela de hóspedes.
     - O `QuartoID` associado a uma reserva não existe ou está associado a um `HotelID` inválido.

#### Impacto na Base de Dados

- **Registos duplicados:** Podem causar confusão em operações de leitura e escrita, resultando em inconsistências nas respostas a consultas.
- **Referências inválidas:** Comprometem a integridade dos dados, pois criam relações irreais ou impossíveis de rastrear.
- **Falta de restrições:** Permite a introdução contínua de erros no sistema, aumentando a dificuldade de manutenção.

#### Etapas de Correção

1. **Eliminar Registos Duplicados:**
   - Analise os registos repetidos em cada tabela e elimine entradas redundantes, mantendo apenas um registo válido para cada `ID` único.
   - Por exemplo, na tabela de hóspedes, mantenha apenas um registo para cada `HospedeID`.

2. **Corrigir Referências Inválidas:**
   - Na tabela de quartos, verifique se todos os `HotelID` são válidos (existem na tabela de hotéis) e elimine ou corrija os registos que não respeitam esta condição.
   - Na tabela de reservas, assegure que todos os `HospedeID` e `QuartoID` referenciados existem nas respetivas tabelas e ajustem ou removam as entradas que não cumprem esta regra.

3. **Reorganizar Dados para Garantir Coerência:**
   - Certifique-se de que todos os dados estão consistentes após a eliminação de duplicados e correção de referências inválidas.
   - Verifique a coerência entre as tabelas, garantindo que cada reserva corresponde a um hóspede e um quarto válidos.

4. **Implementar Restrições para Prevenir Problemas Futuros:**
   - Estabeleça regras que impeçam a introdução de registos duplicados, como a obrigatoriedade de chaves únicas para `HospedeID`, `HotelID`, `QuartoID` e `ReservaID`.
   - Defina restrições de integridade referencial para garantir que todas as relações entre tabelas sejam válidas. Por exemplo:
     - Um quarto deve sempre estar associado a um hotel existente.
     - Uma reserva deve referenciar apenas hóspedes e quartos válidos.

#### Resultados Esperados

- **Eliminação de Duplicados:** Cada tabela conterá apenas registos únicos e válidos, eliminando redundâncias.
- **Coerência nos Dados:** Todas as relações entre tabelas serão consistentes, refletindo a realidade do sistema.
- **Prevenção de Novos Erros:** Restrições adicionais protegerão a base de dados contra a introdução de duplicados ou referências inválidas, garantindo um sistema mais robusto e fácil de manter.


